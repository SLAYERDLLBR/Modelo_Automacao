<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGE - Sistema de Gest√£o de Estoque ConstruForte</title>
    <style>
        :root {
            --primary: #0f172a;
            --accent: #ea580c; /* Laranja constru√ß√£o */
            --bg: #f1f5f9;
            --card: #ffffff;
            --border: #e2e8f0;
            --success: #22c55e;
            --danger: #ef4444;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: #334155;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* CABE√áALHO */
        header {
            text-align: center;
            margin-bottom: 2rem;
        }
        header h1 { color: var(--primary); margin: 0; }
        header p { color: #64748b; margin-top: 5px; }

        /* CART√ÉO DO FORMUL√ÅRIO */
        .card {
            background: var(--card);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            border-top: 5px solid var(--accent);
        }

        .grid-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }

        .form-group { display: flex; flex-direction: column; }
        
        label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        input, select {
            padding: 0.8rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.95rem;
            transition: 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(234, 88, 12, 0.1);
        }

        /* CHECKLIST VISUAL */
        .checklist-box {
            grid-column: 1 / -1;
            background: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            border: 1px dashed #cbd5e1;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .check-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; }
        input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--success); }

        /* BOT√ïES */
        .btn-group {
            grid-column: 1 / -1;
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            flex: 1;
            transition: 0.2s;
        }

        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: #1e293b; }

        .btn-success { background-color: var(--success); color: white; display: none;} /* Escondido at√© ter dados */
        
        /* TABELA DE RESULTADOS */
        .table-container {
            overflow-x: auto;
            background: var(--card);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            padding: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            background-color: #f1f5f9;
            color: var(--primary);
            padding: 1rem;
            text-align: left;
            font-weight: 700;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        tr:hover { background-color: #f8fafc; }

        /* Badges de Status */
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        .bg-ok { background: #dcfce7; color: #166534; }
        .bg-alert { background: #fee2e2; color: #991b1b; }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>üèóÔ∏è SGE - Controle de Recebimento</h1>
            <p>Automa√ß√£o de Entrada de Materiais - Dep√≥sito ConstruForte</p>
        </header>

        <!-- CART√ÉO DE CADASTRO -->
        <div class="card">
            <form id="stockForm">
                <div class="grid-form">
                    
                    <!-- Linha 1 -->
                    <div class="form-group">
                        <label>SKU / C√≥digo</label>
                        <input type="text" id="sku" placeholder="Ex: CIM-001" required>
                    </div>

                    <div class="form-group">
                        <label>Nota Fiscal (NF-e)</label>
                        <input type="number" id="nfe" placeholder="Apenas n√∫meros" required>
                    </div>

                    <div class="form-group">
                        <label>Data de Recebimento</label>
                        <input type="datetime-local" id="dataRecebimento" required>
                    </div>

                    <!-- Linha 2 -->
                    <div class="form-group">
                        <label>Produto</label>
                        <input type="text" id="produto" placeholder="Nome do material" required>
                    </div>

                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="categoria">
                            <option value="Basico">Material B√°sico (Areia/Pedra)</option>
                            <option value="Acabamento">Acabamento</option>
                            <option value="Hidraulica">Hidr√°ulica</option>
                            <option value="Eletrica">El√©trica</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Fornecedor</label>
                        <input type="text" id="fornecedor" required>
                    </div>

                    <!-- Linha 3 -->
                    <div class="form-group">
                        <label>Quantidade</label>
                        <input type="number" id="qtd" min="1" required>
                    </div>

                    <div class="form-group">
                        <label>Localiza√ß√£o (Rua/Prateleira)</label>
                        <input type="text" id="local" placeholder="Ex: Rua B - Prat. 4" required>
                    </div>

                    <div class="form-group">
                        <label>Validade (ODS 12)</label>
                        <input type="date" id="validade">
                    </div>

                    <!-- Checklist -->
                    <div class="checklist-box">
                        <div class="check-item">
                            <input type="checkbox" id="checkConferencia" required>
                            <label for="checkConferencia">Confer√™ncia F√≠sica Realizada</label>
                        </div>
                        <div class="check-item">
                            <input type="checkbox" id="checkAvarias">
                            <label for="checkAvarias">Material com Avaria/Defeito?</label>
                        </div>
                    </div>

                    <!-- Bot√µes -->
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">‚ûï Registrar Entrada</button>
                        <button type="button" id="btnExport" class="btn btn-success" onclick="exportTableToCSV()">üì• Baixar Relat√≥rio Completo (.csv)</button>
                    </div>

                </div>
            </form>
        </div>

        <!-- TABELA DIN√ÇMICA -->
        <div class="table-container">
            <table id="tabelaEstoque">
                <thead>
                    <tr>
                        <th>Data/Hora</th>
                        <th>SKU</th>
                        <th>Produto</th>
                        <th>Qtd.</th>
                        <th>Local</th>
                        <th>Validade</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- As linhas ser√£o inseridas aqui via JavaScript -->
                </tbody>
            </table>
            <p style="text-align: center; color: #94a3b8; font-size: 0.9rem; margin-top: 1rem;" id="emptyMsg">Nenhum registro adicionado nesta sess√£o.</p>
        </div>
    </div>

    <script>
        // Define a data atual no campo automaticamente ao abrir
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('dataRecebimento').value = now.toISOString().slice(0,16);

        // Armazena os dados temporariamente
        let dadosEstoque = [];

        document.getElementById('stockForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // 1. Captura valores
            const item = {
                data: document.getElementById('dataRecebimento').value.replace('T', ' '),
                sku: document.getElementById('sku').value.toUpperCase(),
                nfe: document.getElementById('nfe').value,
                produto: document.getElementById('produto').value,
                categoria: document.getElementById('categoria').value,
                fornecedor: document.getElementById('fornecedor').value,
                qtd: document.getElementById('qtd').value,
                local: document.getElementById('local').value,
                validade: document.getElementById('validade').value || 'N/A',
                avaria: document.getElementById('checkAvarias').checked
            };

            // 2. Adiciona ao Array
            dadosEstoque.push(item);

            // 3. Renderiza na Tabela (Front-End Din√¢mico)
            adicionarLinhaTabela(item);

            // 4. Limpa campos chave
            document.getElementById('sku').value = '';
            document.getElementById('produto').value = '';
            document.getElementById('qtd').value = '';
            document.getElementById('produto').focus();

            // Mostra bot√£o de exportar
            document.getElementById('btnExport').style.display = 'block';
            document.getElementById('emptyMsg').style.display = 'none';
        });

        function adicionarLinhaTabela(item) {
            const tbody = document.querySelector('#tabelaEstoque tbody');
            const tr = document.createElement('tr');

            // L√≥gica de Status (Visual)
            const statusBadge = item.avaria 
                ? '<span class="badge bg-alert">AVARIA</span>' 
                : '<span class="badge bg-ok">APROVADO</span>';

            tr.innerHTML = `
                <td>${item.data}</td>
                <td><strong>${item.sku}</strong></td>
                <td>
                    ${item.produto}<br>
                    <small style="color:#64748b">${item.fornecedor} (NF: ${item.nfe})</small>
                </td>
                <td>${item.qtd}</td>
                <td>${item.local}</td>
                <td>${item.validade}</td>
                <td>${statusBadge}</td>
            `;

            // Adiciona no topo da tabela
            tbody.insertBefore(tr, tbody.firstChild);
        }

        // Fun√ß√£o para Gerar Excel/CSV de TUDO
        function exportTableToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Data;SKU;Produto;Fornecedor;NF;Qtd;Local;Validade;Status\n";

            dadosEstoque.forEach(function(row) {
                let status = row.avaria ? "COM AVARIA" : "OK";
                let rowString = `${row.data};${row.sku};${row.produto};${row.fornecedor};${row.nfe};${row.qtd};${row.local};${row.validade};${status}`;
                csvContent += rowString + "\n";
            });

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "Relatorio_Estoque_Completo.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>